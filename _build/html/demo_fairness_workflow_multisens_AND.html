
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fairness Machine Learning Workflow &#8212; PyFairnessAI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'demo_fairness_workflow_multisens_AND';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Fairness Machine Learning Workflow" href="demo_fairness_workflow_multisens_OR.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="PyFairnessAI - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="PyFairnessAI - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction to PyFairnessAI
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules of <code class="docutils literal notranslate"><span class="pre">PyFairnessAI</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="advantages.html">Advantages of <code class="docutils literal notranslate"><span class="pre">PyFairnessAI</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_fairness_workflow.html">Fairness Machine Learning Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_fairness_workflow_multisens_OR.html">Fairness Machine Learning Workflow</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Fairness Machine Learning Workflow</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/PyFairnessAI-package" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/PyFairnessAI-package/issues/new?title=Issue%20on%20page%20%2Fdemo_fairness_workflow_multisens_AND.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/demo_fairness_workflow_multisens_AND.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fairness Machine Learning Workflow</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-data">Preparing the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-evaluation-method">Outer evaluation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-evaluation-method">Inner evaluation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-pipelines">Defining pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-grids">Defining grids</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-inner-evaluation">Applying inner evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-results">Inner results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#best-pipeline-selection">Best pipeline selection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-outer-evaluation">Applying outer evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance">Estimation of future performance</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="fairness-machine-learning-workflow">
<h1>Fairness Machine Learning Workflow<a class="headerlink" href="#fairness-machine-learning-workflow" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p><strong>Main goal:</strong> finding the <strong>best model</strong> for a <strong>classification problem</strong> (credit scoring problem in this case) according to <strong>both</strong> <strong>predictive</strong> a <strong>fairness</strong> <strong>metrics</strong>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyFairnessAI</span></code> can be used for this purpose.</p></li>
</ul>
<p>A classic Machine Learning approach is used: Inner-Outer Evaluation.</p>
<ul class="simple">
<li><p><strong>Inner</strong>: selecting the best pipeline using k-fold cross-validation and hyper-parameter optimization.</p></li>
<li><p><strong>Outer</strong>: estimating best pipeline future performance through simple validation (train-test split)</p></li>
<li><p><strong>Data</strong>: German data.</p>
<ul>
<li><p><strong>Response/Target</strong> variable: ‘credit-risk’ (values: ‘good’, ‘bad’ (candidate for the credit))</p></li>
<li><p><strong>Predictors</strong>: ‘checking_status’, ‘duration’, ‘credit_history’, ‘purpose’,
‘credit_amount’, ‘savings_status’, ‘employment’,
‘installment_commitment’, ‘other_parties’, ‘residence_since’,
‘property_magnitude’, ‘age’, ‘other_payment_plans’, ‘housing’,
‘existing_credits’, ‘job’, ‘num_dependents’, ‘own_telephone’,
‘foreign_worker’, ‘sex’, ‘marital_status’</p></li>
<li><p><strong>Two sensitive variable (protected attribute)</strong>: ‘age’, ‘sex’.</p>
<ul>
<li><p><strong>Privileged group</strong>: ‘age’: &gt;= 25 years (1); ‘sex’: male (1).</p></li>
<li><p><strong>Unprivileged group</strong>: ‘age’: &lt; 25 years (0); ‘sex’: female (0).</p></li>
</ul>
</li>
<li><p><strong>Multi sensitive variable:</strong> ‘age_sex’, defined by <strong>AND</strong> sum rule.</p>
<ul>
<li><p><strong>Privileged group</strong>: &gt;= 25 years (1) AND  male (1)</p></li>
<li><p><strong>Unprivileged group</strong>: &lt; 25 years (0) OR female (0)</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Pipelines</strong> are used.</p></li>
<li><p><strong>Base models</strong>:</p>
<ul>
<li><p>Logistic Regression</p></li>
<li><p>XGBoost</p></li>
<li><p>LightGBoost</p></li>
<li><p>Random Forest</p></li>
</ul>
</li>
<li><p><strong>Base processors</strong>:</p>
<ul>
<li><p>Imputers</p></li>
<li><p>Encoders</p></li>
<li><p>Scalers</p></li>
</ul>
</li>
<li><p><strong>Fairness processors</strong></p>
<ul>
<li><p><strong>Pre</strong>: Reweighing</p></li>
<li><p><strong>In</strong>: Adversarial Debiasing, Exponentiated Gradient Reduction (ExpGR), Grid Search Reduction (GSR).</p></li>
<li><p><strong>Post</strong>: Calibrated Equalized Odds (CEO), Reject Option Classifier (ROC).</p></li>
<li><p><strong>Pre + In</strong>: Reweighing + ExpGR, Reweighing + GSR.</p></li>
<li><p><strong>Pre + Post</strong>: Reweighing + CEO, Reweighing + ROC.</p></li>
<li><p><strong>Post + Pre</strong>: CEO + Reweighing, ROC + Reweighing.</p></li>
<li><p><strong>Post + In</strong>: CEO + ExpGR, ROC + ExpGR, CEO + GSR, ROC + GSR.</p></li>
</ul>
</li>
<li><p><strong>Fairness metric</strong>: separation (avg odds error)</p></li>
<li><p><strong>Predictive metric</strong>: balanced accuracy</p></li>
</ul>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<p>Necessary packages, function, classes and custom objects for running the code successfully.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">ast</span> 
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">aif360.sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_german</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">PyMachineLearning.preprocessing</span> <span class="kn">import</span> <span class="n">Encoder</span><span class="p">,</span> <span class="n">Scaler</span><span class="p">,</span> <span class="n">Imputer</span><span class="p">,</span> <span class="n">ColumnTransformerToPandas</span>
<span class="kn">from</span> <span class="nn">PyMachineLearning.models</span> <span class="kn">import</span> <span class="n">LogisticRegressionThreshold</span>

<span class="kn">from</span> <span class="nn">PyFairnessAI.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCVFairness</span><span class="p">,</span> <span class="n">combined_score</span>
<span class="kn">from</span> <span class="nn">PyFairnessAI.preprocessing</span> <span class="kn">import</span> <span class="n">ReweighingMetaEstimator</span>
<span class="kn">from</span> <span class="nn">PyFairnessAI.inprocessing</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AdversarialDebiasingEstimator</span><span class="p">,</span> 
                                       <span class="n">ExponentiatedGradientReductionMetaEstimator</span><span class="p">,</span> 
                                       <span class="n">GridSearchReductionMetaEstimator</span><span class="p">,</span> <span class="n">Moment</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyFairnessAI.postprocessing</span> <span class="kn">import</span> <span class="n">CalibratedEqualizedOdds</span><span class="p">,</span> <span class="n">RejectOptionClassifier</span><span class="p">,</span> <span class="n">PostProcessingMetaEstimator</span>
<span class="kn">from</span> <span class="nn">PyFairnessAI.metrics</span> <span class="kn">import</span> <span class="n">average_odds_error</span>

<span class="kn">import</span> <span class="nn">time</span> 

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_key_preprocessing_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fairness_processors</span><span class="p">,</span> <span class="n">preprocessing_grid</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;multi&#39;</span><span class="p">]):</span> <span class="c1"># Fairness multi processor involved in the model</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span>
        <span class="n">key3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">preprocessing_grid_</span> <span class="o">=</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;fairness_processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_in&#39;</span><span class="p">]):</span>
            <span class="n">key2</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_post&#39;</span><span class="p">]):</span>
            <span class="n">key2</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span> <span class="o">+</span> <span class="s1">&#39;__postprocessor&#39;</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_pre&#39;</span><span class="p">]):</span>
            <span class="n">key2</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__postprocessor&#39;</span>   
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_in&#39;</span><span class="p">]):</span>
           <span class="n">key2</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span>
           <span class="n">key3</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__postprocessor&#39;</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="n">key3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]):</span> <span class="c1"># Fairness pre or in processor involved in the model</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;adv_debiasing&#39;</span><span class="p">:</span>
                <span class="n">key1</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key1</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span> 
            <span class="n">preprocessing_grid_</span> <span class="o">=</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;fairness_processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">]):</span> <span class="c1"># Fairness post processor involved in the model</span>
            <span class="n">key1</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__estimator&#39;</span> 
            <span class="n">key2</span> <span class="o">=</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;__postprocessor&#39;</span>
            <span class="n">preprocessing_grid_</span> <span class="o">=</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;fairness_processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>       
        <span class="k">else</span><span class="p">:</span> <span class="c1"># No fairness processor involved</span>
            <span class="n">key1</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">preprocessing_grid_</span> <span class="o">=</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;not_fairness_processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">,</span> <span class="n">preprocessing_grid_</span>

<span class="c1">###################################################################################################################</span>

<span class="k">def</span> <span class="nf">get_model_param_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>

    <span class="k">if</span> <span class="s1">&#39;log_reg&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__C&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__threshold&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
                    <span class="p">}</span>
    
    <span class="k">elif</span> <span class="s1">&#39;XGB&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__reg_lambda&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__n_estimators&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__eta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
                    <span class="p">}</span>

    <span class="k">elif</span> <span class="s1">&#39;LGB&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__max_depth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__num_leaves&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__learning_rate&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__lambda_l1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__lambda_l2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__min_split_gain&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__min_child_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__lambda_feature_fraction&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>                                                                                                           
                      <span class="p">}</span>
    
    <span class="k">elif</span> <span class="s1">&#39;RF&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
        
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__max_depth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__min_samples_leaf&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__min_samples_split&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">]</span>                                                                                                 
                    <span class="p">}</span>
        
    <span class="k">elif</span> <span class="s1">&#39;adv_debiasing&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
        
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__adversary_loss_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__num_epochs&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__batch_size&#39;</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__classifier_num_hidden_units&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__debias&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>   
                    <span class="p">}</span>
        
    <span class="k">return</span> <span class="n">param_grid</span>

<span class="c1">###################################################################################################################</span>

<span class="k">def</span> <span class="nf">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">processor</span> <span class="o">==</span> <span class="s1">&#39;expGR&#39;</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__constraints&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DemographicParity&#39;</span><span class="p">,</span> <span class="s1">&#39;EqualizedOdds&#39;</span><span class="p">,</span> 
                                              <span class="s1">&#39;TruePositiveRateParity&#39;</span><span class="p">,</span> <span class="s1">&#39;ErrorRateParity&#39;</span><span class="p">],</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__eps&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__max_iter&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__eta0&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__drop_prot_attr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                    <span class="p">}</span>   
        
    <span class="k">elif</span> <span class="n">processor</span> <span class="o">==</span> <span class="s1">&#39;GSR&#39;</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__constraints&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DemographicParity&#39;</span><span class="p">,</span> <span class="s1">&#39;EqualizedOdds&#39;</span><span class="p">,</span> 
                                              <span class="s1">&#39;TruePositiveRateParity&#39;</span><span class="p">,</span> <span class="s1">&#39;ErrorRateParity&#39;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__constraint_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__grid_size&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__grid_limit&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__loss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ZeroOne&#39;</span><span class="p">,</span> <span class="s1">&#39;Square&#39;</span><span class="p">,</span> <span class="s1">&#39;Absolute&#39;</span><span class="p">],</span>                                
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__drop_prot_attr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                    <span class="p">}</span>  
    
    <span class="k">elif</span> <span class="n">processor</span> <span class="o">==</span> <span class="s1">&#39;CEO&#39;</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__cost_constraint&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;fpr&#39;</span><span class="p">,</span> <span class="s1">&#39;fnr&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]}</span>

    <span class="k">elif</span> <span class="n">processor</span> <span class="o">==</span> <span class="s1">&#39;ROC&#39;</span><span class="p">:</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__threshold&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span> <span class="c1"># must be between 0-0.5</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">__margin&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">)</span> <span class="c1"># must be between 0-0.05</span>
                    <span class="p">}</span>
        
    <span class="k">return</span> <span class="n">param_grid</span>

<span class="c1">###################################################################################################################</span>

<span class="k">def</span> <span class="nf">get_pipeline_param_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fairness_processors</span><span class="p">,</span> <span class="n">preprocessing_grid</span><span class="p">):</span>

    <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">,</span> <span class="n">preprocessing_grid_</span> <span class="o">=</span> <span class="n">get_key_preprocessing_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fairness_processors</span><span class="p">,</span> <span class="n">preprocessing_grid</span><span class="p">)</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">preprocessing_grid_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_model_param_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key1</span><span class="p">))</span> 
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;multi&#39;</span><span class="p">]):</span> <span class="c1"># Multi processor involved</span>

        <span class="k">if</span> <span class="s1">&#39;reweighing_&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span> 

            <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key2</span><span class="p">))</span> 
        
        <span class="k">elif</span> <span class="s1">&#39;_reweighing&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span> 

            <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key2</span><span class="p">))</span> 

        <span class="k">else</span><span class="p">:</span>

            <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key2</span><span class="p">))</span>
            <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key3</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span> <span class="c1"># Not multi processor (no fairness processor or pre/in/post processor)</span>
                
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]):</span> <span class="c1"># in processor  </span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">!=</span> <span class="s1">&#39;adv_debiasing&#39;</span><span class="p">:</span>
                <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">model</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">]):</span> <span class="c1"># post processor </span>

            <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_processor_param_grid</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">param_grid</span>

<span class="c1">###################################################################################################################</span>

<span class="k">def</span> <span class="nf">n_iter</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>

    <span class="k">if</span> <span class="s1">&#39;XGB&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="s1">&#39;RF&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;notebook&#39;</span><span class="p">,</span> <span class="s1">&#39;--sum_rule&#39;</span><span class="p">,</span> <span class="s1">&#39;AND&#39;</span><span class="p">]</span> <span class="c1"># Use only in Jupyter Notebooks, not needed in Python scripts. </span>
<span class="c1"># AND is being the assumed argument for the sum rule, that is, the rule for defining the multi sensitive variable.</span>

<span class="c1"># Argument parsing</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process the sum_rule parameter.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--sum_rule&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span> <span class="s1">&#39;OR&#39;</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The sum rule to apply: AND or OR&#39;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="preparing-the-data">
<h2>Preparing the data<a class="headerlink" href="#preparing-the-data" title="Link to this heading">#</a></h2>
<p>Here we fetch an prepare the data properly to work with <code class="docutils literal notranslate"><span class="pre">PyFairnessAI</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtaining the data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fetch_german</span><span class="p">(</span><span class="n">binary_age</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Defining the individual sensitive variables (protected attributes)</span>
<span class="n">sens_variable_1</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span> <span class="c1"># name of first sensitive variable</span>
<span class="n">sens_variable_2</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span> <span class="c1"># name of second sensitive variable</span>
<span class="c1"># Encoding the sensitive variables</span>
<span class="n">X</span><span class="p">[</span><span class="n">sens_variable_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sens_variable_1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">25</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ordinal&#39;</span><span class="p">)</span>
<span class="n">X</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">X</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="c1"># Defining the label of the privileged groups </span>
<span class="n">sens_1_priv_group</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 1: &gt;= 25 years, 0: &lt; 25 years</span>
<span class="n">sens_2_priv_group</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 1: male, 0: female</span>
<span class="c1"># Encoding the response variable (needed for scikit-learn objects)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="c1"># good: 1 , bad: 0</span>
<span class="c1"># Defining the positive label of the response variable</span>
<span class="n">response_favorable_label</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># &#39;good&#39; before encoding</span>

<span class="c1"># Defining the multi sensitive variable based on the individual ones (&#39;age&#39;, &#39;sex&#39;).</span>
<span class="c1"># Two possible sum rules are considered for defining the multi sens variable: AND, OR</span>
<span class="c1"># AND: the new privileged group is defined as the intersection of the privileged groups of the individual sens variables.</span>
<span class="c1"># OR: the new privileged group is defined as the union of the privileged groups of the individual sens variables.</span>
<span class="n">sens_variable</span> <span class="o">=</span> <span class="s1">&#39;age_sex&#39;</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sum_rule</span> <span class="o">==</span> <span class="s1">&#39;AND&#39;</span><span class="p">:</span> 
    <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sens_variable_1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sens_1_priv_group</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span> <span class="o">==</span> <span class="n">sens_2_priv_group</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">sum_rule</span> <span class="o">==</span> <span class="s1">&#39;OR&#39;</span><span class="p">:</span>
    <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sens_variable_1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sens_1_priv_group</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="n">sens_variable_2</span><span class="p">]</span> <span class="o">==</span> <span class="n">sens_2_priv_group</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Defining the privileged group of the new  (multi) sensitive variable </span>
<span class="n">sens_priv_group</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 1 (priv group): &#39;&gt;= 25&#39; years AND/OR &#39;male&#39;, 0 (unpriv group): otherwise (&#39;&lt; 25&#39; years OR/AND &#39;female&#39;)</span>
<span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span> <span class="c1"># necessary to work properly with some aif360 objects</span>

<span class="c1"># Removing the individual sensitive variables </span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">sens_variable_1</span><span class="p">,</span> <span class="n">sens_variable_2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Indexing with the sens_variable is needed for fairness post-processing</span>
<span class="n">X</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span> 
<span class="n">y</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span>  
<span class="c1"># A is needed for some fairness metric objects</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">sens_variable</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>checking_status</th>
      <th>duration</th>
      <th>credit_history</th>
      <th>purpose</th>
      <th>credit_amount</th>
      <th>savings_status</th>
      <th>employment</th>
      <th>installment_commitment</th>
      <th>other_parties</th>
      <th>residence_since</th>
      <th>property_magnitude</th>
      <th>other_payment_plans</th>
      <th>housing</th>
      <th>existing_credits</th>
      <th>job</th>
      <th>num_dependents</th>
      <th>own_telephone</th>
      <th>foreign_worker</th>
      <th>marital_status</th>
      <th>age_sex</th>
    </tr>
    <tr>
      <th>age_sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>&lt;0</td>
      <td>6</td>
      <td>critical/other existing credit</td>
      <td>radio/tv</td>
      <td>1169</td>
      <td>no known savings</td>
      <td>&gt;=7</td>
      <td>4</td>
      <td>none</td>
      <td>4</td>
      <td>real estate</td>
      <td>none</td>
      <td>own</td>
      <td>2</td>
      <td>skilled</td>
      <td>1</td>
      <td>yes</td>
      <td>yes</td>
      <td>single</td>
      <td>1</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0&lt;=X&lt;200</td>
      <td>48</td>
      <td>existing paid</td>
      <td>radio/tv</td>
      <td>5951</td>
      <td>&lt;100</td>
      <td>1&lt;=X&lt;4</td>
      <td>2</td>
      <td>none</td>
      <td>2</td>
      <td>real estate</td>
      <td>none</td>
      <td>own</td>
      <td>1</td>
      <td>skilled</td>
      <td>1</td>
      <td>none</td>
      <td>yes</td>
      <td>div/dep/mar</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>no checking</td>
      <td>12</td>
      <td>critical/other existing credit</td>
      <td>education</td>
      <td>2096</td>
      <td>&lt;100</td>
      <td>4&lt;=X&lt;7</td>
      <td>2</td>
      <td>none</td>
      <td>3</td>
      <td>real estate</td>
      <td>none</td>
      <td>own</td>
      <td>1</td>
      <td>unskilled resident</td>
      <td>2</td>
      <td>none</td>
      <td>yes</td>
      <td>single</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;0</td>
      <td>42</td>
      <td>existing paid</td>
      <td>furniture/equipment</td>
      <td>7882</td>
      <td>&lt;100</td>
      <td>4&lt;=X&lt;7</td>
      <td>2</td>
      <td>guarantor</td>
      <td>4</td>
      <td>life insurance</td>
      <td>none</td>
      <td>for free</td>
      <td>1</td>
      <td>skilled</td>
      <td>2</td>
      <td>none</td>
      <td>yes</td>
      <td>single</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;0</td>
      <td>24</td>
      <td>delayed previously</td>
      <td>new car</td>
      <td>4870</td>
      <td>&lt;100</td>
      <td>1&lt;=X&lt;4</td>
      <td>3</td>
      <td>none</td>
      <td>4</td>
      <td>no known property</td>
      <td>none</td>
      <td>for free</td>
      <td>2</td>
      <td>skilled</td>
      <td>2</td>
      <td>none</td>
      <td>yes</td>
      <td>single</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 20)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>age_sex
1    1.0
0    0.0
1    1.0
1    1.0
1    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collecting the quant and categorical predictors, as well as all the predictors.</span>
<span class="n">quant_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;category&#39;</span><span class="p">]</span>
<span class="n">cat_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">quant_predictors</span><span class="p">]</span>  
<span class="n">predictors</span> <span class="o">=</span> <span class="n">quant_predictors</span> <span class="o">+</span> <span class="n">cat_predictors</span> <span class="c1"># X.columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_predictors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;duration&#39;,
 &#39;credit_amount&#39;,
 &#39;installment_commitment&#39;,
 &#39;residence_since&#39;,
 &#39;existing_credits&#39;,
 &#39;num_dependents&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_predictors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;checking_status&#39;,
 &#39;credit_history&#39;,
 &#39;purpose&#39;,
 &#39;savings_status&#39;,
 &#39;employment&#39;,
 &#39;other_parties&#39;,
 &#39;property_magnitude&#39;,
 &#39;other_payment_plans&#39;,
 &#39;housing&#39;,
 &#39;job&#39;,
 &#39;own_telephone&#39;,
 &#39;foreign_worker&#39;,
 &#39;marital_status&#39;,
 &#39;age_sex&#39;]
</pre></div>
</div>
</div>
</div>
<section id="outer-evaluation-method">
<h3>Outer evaluation method<a class="headerlink" href="#outer-evaluation-method" title="Link to this heading">#</a></h3>
<p>Defining the outer evaluation method: simple validation (train-test split), stratified by the response variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">A_train</span><span class="p">,</span> <span class="n">A_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># A_test is needed for outer evaluation (estimation of future performance) with respect to fairness </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inner-evaluation-method">
<h3>Inner evaluation method<a class="headerlink" href="#inner-evaluation-method" title="Link to this heading">#</a></h3>
<p>Defining the inner evaluation method: stratified k-Fold Cross-Validation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inner</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-pipelines">
<h3>Defining pipelines<a class="headerlink" href="#defining-pipelines" title="Link to this heading">#</a></h3>
<p>Defining the pipelines, which encompasses base processors, fairness processors and base models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">,</span> <span class="n">fairness_processors</span><span class="p">,</span> <span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="n">quant_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">Imputer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">Scaler</span><span class="p">())</span>
    <span class="p">])</span>

<span class="n">cat_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">Imputer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;simple_most_frequent&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;encoder&#39;</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;one-hot&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">quant_cat_processing</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;quant&#39;</span><span class="p">,</span> <span class="n">quant_pipeline</span><span class="p">,</span> <span class="n">quant_predictors</span><span class="p">),</span>
                                                       <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">cat_pipeline</span><span class="p">,</span> <span class="n">cat_predictors</span><span class="p">)])</span>


<span class="c1"># Set up TensorFlow session (required by AdversarialDebiasingEstimator)</span>
<span class="n">tf_session</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span>
<span class="c1"># disable_eager_execution is required as well by TensorFlow</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">disable_eager_execution</span><span class="p">()</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">ceo</span> <span class="o">=</span> <span class="n">CalibratedEqualizedOdds</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">roc</span> <span class="o">=</span> <span class="n">RejectOptionClassifier</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogisticRegressionThreshold</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># Fairness Pre-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># Fairness Pre-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># Fairness Pre-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># Fairness Pre-Processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;adv_debiasing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AdversarialDebiasingEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">scope_name</span><span class="o">=</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span> <span class="c1"># Fairness In-Processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentiatedGradientReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentiatedGradientReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentiatedGradientReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExponentiatedGradientReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridSearchReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridSearchReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridSearchReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridSearchReductionMetaEstimator</span><span class="p">(</span><span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span> <span class="c1"># Fairness In-Processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1"># Fairnes post-processor</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_expGR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_expGR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_expGR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_expGR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_GSR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_GSR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_GSR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_GSR&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + in</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_CEO&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_CEO&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_CEO&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing_CEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_CEO&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_ROC&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_ROC&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_ROC&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing_ROC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReweighingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_ROC&#39;</span><span class="p">],</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">)</span> <span class="c1"># pre + post</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_CEO_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_CEO_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_CEO_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_CEO_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_ROC_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_ROC_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_ROC_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_ROC_reweighing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_reweighing&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + pre</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_CEO_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_CEO_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_CEO_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_CEO_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_ROC_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_ROC_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_ROC_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_ROC_expGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_expGR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_CEO_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_CEO_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_CEO_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_CEO_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">ceo</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>

<span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_ROC_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;log_reg_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_ROC_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;XGB_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_ROC_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;LGB_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>
<span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_ROC_GSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PostProcessingMetaEstimator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;RF_GSR&#39;</span><span class="p">],</span> <span class="n">postprocessor</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># post + in</span>

<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reweighing&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;expGR&#39;</span><span class="p">,</span> <span class="s1">&#39;GSR&#39;</span><span class="p">,</span> <span class="s1">&#39;adv_debiasing&#39;</span><span class="p">]</span> 
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CEO&#39;</span><span class="p">,</span> <span class="s1">&#39;ROC&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reweighing_expGR&#39;</span><span class="p">,</span> <span class="s1">&#39;reweighing_GSR&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reweighing_CEO&#39;</span><span class="p">,</span> <span class="s1">&#39;reweighing_ROC&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CEO_reweighing&#39;</span><span class="p">,</span> <span class="s1">&#39;ROC_reweighing&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CEO_expGR&#39;</span><span class="p">,</span> <span class="s1">&#39;ROC_expGR&#39;</span><span class="p">,</span> <span class="s1">&#39;CEO_GSR&#39;</span><span class="p">,</span> <span class="s1">&#39;ROC_GSR&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;multi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_in&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;pre_post&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;post_in&#39;</span><span class="p">]</span>
<span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">fairness_processors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="k">if</span>  <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">key</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fairness_processors</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]):</span> <span class="c1"># model[key] involves fairness processor</span>

        <span class="n">pipelines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="c1"># Fairness processors need a Pandas df X as input to read the sens_variable_name</span>
                <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">ColumnTransformerToPandas</span><span class="p">(</span><span class="n">column_transformer</span><span class="o">=</span><span class="n">quant_cat_processing</span><span class="p">,</span>
                                                            <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span>  
                                                            <span class="n">prot_attr_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="c1"># prot_attr_index=True needed for fairness post-processors</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> 
                <span class="p">])</span>            

    <span class="k">else</span><span class="p">:</span> <span class="c1"># model[key] does not involve fairness processor</span>

        <span class="n">pipelines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> 
                <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-grids">
<h3>Defining grids<a class="headerlink" href="#defining-grids" title="Link to this heading">#</a></h3>
<p>Defining the grids for the parameters of each pipeline to be explored in the hyper-parameter optimization (HPO) part.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;not_fairness_processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;preprocessing__quant__scaler__apply&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                                                <span class="s1">&#39;preprocessing__quant__scaler__method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="s1">&#39;min-max&#39;</span><span class="p">],</span>
                                                <span class="s1">&#39;preprocessing__cat__encoder__method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ordinal&#39;</span><span class="p">,</span> <span class="s1">&#39;one-hot&#39;</span><span class="p">],</span>
                                                <span class="s1">&#39;preprocessing__cat__imputer__apply&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
                                                <span class="s1">&#39;preprocessing__quant__imputer__apply&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
                                               <span class="c1">#&#39;preprocessing__cat__imputer__method&#39;:  [&#39;simple_most_frequent&#39;],</span>
                                               <span class="c1">#&#39;preprocessing__quant__imputer__method&#39;: [&#39;simple_mean&#39;, &#39;simple_median&#39;]</span>
                                                <span class="p">}</span>

<span class="c1"># Same as  preprocessing_grid[&#39;not_fairness_preprocessor&#39;] but adding &#39;__column_transformer__&#39; to the keys (needed in ColumnTransformerToPandas)        </span>
<span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;fairness_processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;column_transformer&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="p">:</span> <span class="n">v</span> 
                                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;not_fairness_processor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">param_grid</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_pipeline_param_grid</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fairness_processors</span><span class="p">,</span> <span class="n">preprocessing_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="applying-inner-evaluation">
<h2>Applying inner evaluation<a class="headerlink" href="#applying-inner-evaluation" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Finding the best model based on fairness and predictive metrics.</p></li>
</ul>
<p>The idea is to apply the combined score in two steps/stages:</p>
<ol class="arabic simple">
<li><p>For optimizing the hyper-parameters of each model and obtaining their best version according to both predictive power and fairness degree.</p></li>
<li><p>For selecting the final best model according to both predictive power and fairness degree.</p></li>
</ol>
<p>In this first step we apply HPO on all the defined pipelines, looking for the best trade-off between predictive power and fairness as objective of the optimization process.</p>
<p>After this steps we will have the best version of each alternative (pipeline).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_results_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">fairness_random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCVFairness</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> 
                                                        <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> 
                                                        <span class="n">fairness_scoring</span><span class="o">=</span><span class="s1">&#39;average_odds_error&#39;</span><span class="p">,</span> 
                                                        <span class="n">predictive_scoring</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">,</span>
                                                        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;combined&#39;</span><span class="p">,</span> 
                                                        <span class="n">fairness_scoring_direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span>
                                                        <span class="n">predictive_scoring_direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span>
                                                        <span class="n">fairness_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">predictive_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                                        <span class="n">cv</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> 
                                                        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                                        <span class="n">prot_attr</span><span class="o">=</span><span class="n">sens_variable</span><span class="p">,</span> 
                                                        <span class="n">priv_group</span><span class="o">=</span><span class="n">sens_priv_group</span><span class="p">,</span>
                                                        <span class="n">pos_label</span><span class="o">=</span><span class="n">response_favorable_label</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fairness_random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">best_result_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">elapsed_time</span><span class="p">}</span>
    <span class="n">best_result_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">fairness_random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">best_results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_result_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once the best results for each pipeline are collected, the second step is to apply the combined score again, but this time on these best results, so that we will be able to select the best final alternative (pipeline) in terms of both fairness and prediction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">best_results_list</span><span class="p">)</span>
<span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;combined-score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_score</span><span class="p">(</span><span class="n">predictive_scores</span><span class="o">=</span><span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;predictive-score&#39;</span><span class="p">],</span> 
                                                <span class="n">fairness_scores</span><span class="o">=</span><span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;fairness-score&#39;</span><span class="p">],</span> 
                                                <span class="n">predictive_scoring_direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                                                <span class="n">fairness_scoring_direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span>
                                                <span class="n">predictive_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fairness_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">best_results</span> <span class="o">=</span> <span class="n">best_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;combined-score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now the final results are saved as a .csv file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;best_results_fairness_workflow_multisens_</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">sum_rule</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="sa">rf</span><span class="s1">&#39;C:\Users\fscielzo\Documents\IBiDat\Fairness AI\PyFairnessAI-package\notebooks\Project-notebooks\results\</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">.csv&#39;</span>

<span class="c1"># Check if the file already exists</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_path</span><span class="p">):</span>
    <span class="c1"># If the file doesn&#39;t exist, save the CSV</span>
    <span class="n">best_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File saved at: </span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists at: </span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="inner-results">
<h3>Inner results<a class="headerlink" href="#inner-results" title="Link to this heading">#</a></h3>
<p>In this section the inner results (the ones collected above) will be analyzed.</p>
<p>We read the results saved as a .csv file. This file contains, for each tested pipeline, information regarding the its name (<code class="docutils literal notranslate"><span class="pre">model</span></code>), its execution in the inner evaluation (<code class="docutils literal notranslate"><span class="pre">time</span></code>), its optimized parameters resulting of HPO process (<code class="docutils literal notranslate"><span class="pre">params</span></code>) and, finally, its predictive, fairness and combined score (<code class="docutils literal notranslate"><span class="pre">predictive-score</span></code>, <code class="docutils literal notranslate"><span class="pre">fairness-score</span></code>, <code class="docutils literal notranslate"><span class="pre">combined-score</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;best_results_fairness_workflow_multisens_AND&#39;</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="sa">rf</span><span class="s1">&#39;C:\Users\fscielzo\Documents\IBiDat\Fairness AI\PyFairnessAI-package\notebooks\Project-notebooks\results\</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">_v3.csv&#39;</span>
<span class="n">best_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The top five results are displayed in the following table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>time</th>
      <th>params</th>
      <th>predictive-score</th>
      <th>fairness-score</th>
      <th>combined-score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>log_reg_reweighing</td>
      <td>12.865</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': False, 'preprocessing__column_transformer__quant__scaler__method': 'min-max', 'preprocessing__column_transformer__cat__encoder__method': 'one-hot', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'log_reg_reweighing__estimator__penalty': 'l1', 'log_reg_reweighing__estimator__C': 50, 'log_reg_reweighing__estimator__class_weight': 'balanced', 'log_reg_reweighing__estimator__threshold': 0.7}</td>
      <td>0.706667</td>
      <td>0.072876</td>
      <td>0.839245</td>
    </tr>
    <tr>
      <th>53</th>
      <td>log_reg_ROC_expGR</td>
      <td>337.138</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': False, 'preprocessing__column_transformer__quant__scaler__method': 'standard', 'preprocessing__column_transformer__cat__encoder__method': 'one-hot', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'log_reg_ROC_expGR__estimator__estimator__penalty': 'l2', 'log_reg_ROC_expGR__estimator__estimator__C': 0.1, 'log_reg_ROC_expGR__estimator__estimator__class_weight': None, 'log_reg_ROC_expGR__estimator__estimator__threshold': 0.7, 'log_reg_ROC_expGR__estimator__constraints': 'EqualizedOdds', 'log_reg_ROC_expGR__estimator__eps': 0.085, 'log_reg_ROC_expGR__estimator__max_iter': 60, 'log_reg_ROC_expGR__estimator__eta0': 2.900000000000001, 'log_reg_ROC_expGR__estimator__drop_prot_attr': False, 'log_reg_ROC_expGR__postprocessor__threshold': 0.26, 'log_reg_ROC_expGR__postprocessor__margin': 0.045}</td>
      <td>0.718095</td>
      <td>0.085010</td>
      <td>0.834495</td>
    </tr>
    <tr>
      <th>41</th>
      <td>log_reg_CEO_reweighing</td>
      <td>40.338</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': True, 'preprocessing__column_transformer__quant__scaler__method': 'standard', 'preprocessing__column_transformer__cat__encoder__method': 'one-hot', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'log_reg_CEO_reweighing__estimator__estimator__penalty': 'l2', 'log_reg_CEO_reweighing__estimator__estimator__C': 50, 'log_reg_CEO_reweighing__estimator__estimator__class_weight': 'balanced', 'log_reg_CEO_reweighing__estimator__estimator__threshold': 0.2, 'log_reg_CEO_reweighing__postprocessor__cost_constraint': 'fpr'}</td>
      <td>0.689206</td>
      <td>0.061719</td>
      <td>0.826259</td>
    </tr>
    <tr>
      <th>45</th>
      <td>log_reg_ROC_reweighing</td>
      <td>33.275</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': False, 'preprocessing__column_transformer__quant__scaler__method': 'standard', 'preprocessing__column_transformer__cat__encoder__method': 'one-hot', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'log_reg_ROC_reweighing__estimator__estimator__penalty': 'l1', 'log_reg_ROC_reweighing__estimator__estimator__C': 1, 'log_reg_ROC_reweighing__estimator__estimator__class_weight': 'balanced', 'log_reg_ROC_reweighing__estimator__estimator__threshold': 0.9, 'log_reg_ROC_reweighing__postprocessor__threshold': 0.37999999999999995, 'log_reg_ROC_reweighing__postprocessor__margin': 0.01}</td>
      <td>0.685714</td>
      <td>0.064324</td>
      <td>0.810400</td>
    </tr>
    <tr>
      <th>21</th>
      <td>log_reg_ROC</td>
      <td>12.383</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': False, 'preprocessing__column_transformer__quant__scaler__method': 'standard', 'preprocessing__column_transformer__cat__encoder__method': 'one-hot', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'log_reg_ROC__estimator__penalty': 'l1', 'log_reg_ROC__estimator__C': 1, 'log_reg_ROC__estimator__class_weight': 'balanced', 'log_reg_ROC__estimator__threshold': 0.2, 'log_reg_ROC__postprocessor__threshold': 0.44, 'log_reg_ROC__postprocessor__margin': 0.045}</td>
      <td>0.704762</td>
      <td>0.082612</td>
      <td>0.807790</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The worst five results are displayed in the following table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_results</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>time</th>
      <th>params</th>
      <th>predictive-score</th>
      <th>fairness-score</th>
      <th>combined-score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>52</th>
      <td>RF_CEO_expGR</td>
      <td>726.029</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': True, 'preprocessing__column_transformer__quant__scaler__method': 'min-max', 'preprocessing__column_transformer__cat__encoder__method': 'ordinal', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'RF_CEO_expGR__estimator__estimator__max_depth': 10, 'RF_CEO_expGR__estimator__estimator__min_samples_leaf': 13, 'RF_CEO_expGR__estimator__estimator__min_samples_split': 7, 'RF_CEO_expGR__estimator__estimator__n_estimators': 50, 'RF_CEO_expGR__estimator__estimator__criterion': 'entropy', 'RF_CEO_expGR__estimator__constraints': 'DemographicParity', 'RF_CEO_expGR__estimator__eps': 0.052000000000000005, 'RF_CEO_expGR__estimator__max_iter': 55, 'RF_CEO_expGR__estimator__eta0': 1.3000000000000003, 'RF_CEO_expGR__estimator__drop_prot_attr': False, 'RF_CEO_expGR__postprocessor__cost_constraint': 'fnr'}</td>
      <td>0.574921</td>
      <td>0.072442</td>
      <td>0.511590</td>
    </tr>
    <tr>
      <th>64</th>
      <td>RF_ROC_GSR</td>
      <td>447.533</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': True, 'preprocessing__column_transformer__quant__scaler__method': 'min-max', 'preprocessing__column_transformer__cat__encoder__method': 'ordinal', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'RF_ROC_GSR__estimator__estimator__max_depth': 2, 'RF_ROC_GSR__estimator__estimator__min_samples_leaf': 7, 'RF_ROC_GSR__estimator__estimator__min_samples_split': 13, 'RF_ROC_GSR__estimator__estimator__n_estimators': 100, 'RF_ROC_GSR__estimator__estimator__criterion': 'gini', 'RF_ROC_GSR__estimator__constraints': 'DemographicParity', 'RF_ROC_GSR__estimator__constraint_weight': 0.11, 'RF_ROC_GSR__estimator__grid_size': 15, 'RF_ROC_GSR__estimator__grid_limit': 3, 'RF_ROC_GSR__estimator__loss': 'ZeroOne', 'RF_ROC_GSR__estimator__drop_prot_attr': False, 'RF_ROC_GSR__postprocessor__threshold': 0.44, 'RF_ROC_GSR__postprocessor__margin': 0.045}</td>
      <td>0.520952</td>
      <td>0.028254</td>
      <td>0.498068</td>
    </tr>
    <tr>
      <th>47</th>
      <td>LGB_ROC_reweighing</td>
      <td>55.764</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': True, 'preprocessing__column_transformer__quant__scaler__method': 'min-max', 'preprocessing__column_transformer__cat__encoder__method': 'ordinal', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'LGB_ROC_reweighing__estimator__estimator__max_depth': 8, 'LGB_ROC_reweighing__estimator__estimator__num_leaves': 4, 'LGB_ROC_reweighing__estimator__estimator__n_estimators': 100, 'LGB_ROC_reweighing__estimator__estimator__learning_rate': 0.064, 'LGB_ROC_reweighing__estimator__estimator__reg_alpha': 0.436, 'LGB_ROC_reweighing__estimator__estimator__reg_lambda': 0.066, 'LGB_ROC_reweighing__estimator__estimator__min_split_gain': 0.003, 'LGB_ROC_reweighing__estimator__estimator__min_child_weight': 13, 'LGB_ROC_reweighing__estimator__estimator__feature_fraction': 0.6000000000000002, 'LGB_ROC_reweighing__postprocessor__threshold': 0.35, 'LGB_ROC_reweighing__postprocessor__margin': 0.024999999999999998}</td>
      <td>0.571111</td>
      <td>0.076310</td>
      <td>0.491474</td>
    </tr>
    <tr>
      <th>58</th>
      <td>XGB_CEO_GSR</td>
      <td>99.610</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': False, 'preprocessing__column_transformer__quant__scaler__method': 'min-max', 'preprocessing__column_transformer__cat__encoder__method': 'ordinal', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'XGB_CEO_GSR__estimator__estimator__max_depth': 20, 'XGB_CEO_GSR__estimator__estimator__reg_lambda': 0.8500000000000001, 'XGB_CEO_GSR__estimator__estimator__n_estimators': 100, 'XGB_CEO_GSR__estimator__estimator__eta': 0.12, 'XGB_CEO_GSR__estimator__estimator__alpha': 0.7900000000000005, 'XGB_CEO_GSR__estimator__constraints': 'DemographicParity', 'XGB_CEO_GSR__estimator__constraint_weight': 0.01, 'XGB_CEO_GSR__estimator__grid_size': 15, 'XGB_CEO_GSR__estimator__grid_limit': 8, 'XGB_CEO_GSR__estimator__loss': 'ZeroOne', 'XGB_CEO_GSR__estimator__drop_prot_attr': True, 'XGB_CEO_GSR__postprocessor__cost_constraint': 'fnr'}</td>
      <td>0.610476</td>
      <td>0.167192</td>
      <td>0.340495</td>
    </tr>
    <tr>
      <th>50</th>
      <td>XGB_CEO_expGR</td>
      <td>1904.376</td>
      <td>{'preprocessing__column_transformer__quant__scaler__apply': True, 'preprocessing__column_transformer__quant__scaler__method': 'standard', 'preprocessing__column_transformer__cat__encoder__method': 'ordinal', 'preprocessing__column_transformer__cat__imputer__apply': False, 'preprocessing__column_transformer__quant__imputer__apply': False, 'XGB_CEO_expGR__estimator__estimator__max_depth': 20, 'XGB_CEO_expGR__estimator__estimator__reg_lambda': 0.45, 'XGB_CEO_expGR__estimator__estimator__n_estimators': 100, 'XGB_CEO_expGR__estimator__estimator__eta': 0.1, 'XGB_CEO_expGR__estimator__estimator__alpha': 0.36000000000000015, 'XGB_CEO_expGR__estimator__constraints': 'TruePositiveRateParity', 'XGB_CEO_expGR__estimator__eps': 0.022000000000000002, 'XGB_CEO_expGR__estimator__max_iter': 45, 'XGB_CEO_expGR__estimator__eta0': 3.7000000000000006, 'XGB_CEO_expGR__estimator__drop_prot_attr': False, 'XGB_CEO_expGR__postprocessor__cost_constraint': 'fnr'}</td>
      <td>0.635873</td>
      <td>0.209870</td>
      <td>0.286846</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="best-pipeline-selection">
<h3>Best pipeline selection<a class="headerlink" href="#best-pipeline-selection" title="Link to this heading">#</a></h3>
<p>In this section the best alternative (pipeline) over all, in terms of both fairness and predictive power,  will be selected.</p>
<p>For illustration and interpretation purposes, several ranking plots will be displayed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_top</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_worst</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;combined-score&#39;</span><span class="p">,</span> <span class="s1">&#39;predictive-score&#39;</span><span class="p">,</span> <span class="s1">&#39;fairness-score&#39;</span><span class="p">]</span>
<span class="n">top_pipelines</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_top</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">worst_pipelines</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n_worst</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">top_scores</span><span class="p">,</span> <span class="n">worst_scores</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span> 
    <span class="n">top_scores</span><span class="p">[</span><span class="n">score</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_top</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">worst_scores</span><span class="p">[</span><span class="n">score</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n_worst</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">best_pipeline</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">worst_pipeline</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">best_score</span><span class="p">,</span> <span class="n">worst_score</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
    <span class="n">best_score</span><span class="p">[</span><span class="n">score</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">worst_score</span><span class="p">[</span><span class="n">score</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_results</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">top_pipelines</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">top_scores</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pipeline</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">best_score</span><span class="p">[</span><span class="n">score</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Models vs. </span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pipelines&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>    

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Top </span><span class="si">{</span><span class="n">n_top</span><span class="si">}</span><span class="s1"> pipelines - Inner Evaluation (5-Fold CV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2308e87ba7aae384f0ea973fbd4f158e7fb74a5959d1f65385a8e04648f02c1c.png" src="_images/2308e87ba7aae384f0ea973fbd4f158e7fb74a5959d1f65385a8e04648f02c1c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">worst_pipelines</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">worst_scores</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">worst_pipeline</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">worst_score</span><span class="p">[</span><span class="n">score</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Models vs. </span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pipelines&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>    

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Worst </span><span class="si">{</span><span class="n">n_worst</span><span class="si">}</span><span class="s1"> pipelines - Inner Evaluation (5-Fold CV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3aad1d0e0f7922452545c7ee5ea9acd21251decc7361ff7994a049dac5f7c833.png" src="_images/3aad1d0e0f7922452545c7ee5ea9acd21251decc7361ff7994a049dac5f7c833.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">best_results</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pipeline</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">best_score</span><span class="p">[</span><span class="n">score</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">worst_pipeline</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">worst_score</span><span class="p">[</span><span class="n">score</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Models vs. </span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pipelines&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>    

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pipeline Selection - 5-Fold CV&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e8ca8acbcc3596229edae51fe560525157c09b008dd70ffdc8c0fb2234b8a6a3.png" src="_images/e8ca8acbcc3596229edae51fe560525157c09b008dd70ffdc8c0fb2234b8a6a3.png" />
</div>
</div>
<p>Finally, the best alternative (pipeline) regarding accuracy and fairness is the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;log_reg_reweighing&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="n">best_pipeline</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformerToPandas(column_transformer=ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                                                               Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                                                Imputer()),
                                                                                                               (&#x27;scaler&#x27;,
                                                                                                                Scaler())]),
                                                                                               [&#x27;duration&#x27;,
                                                                                                &#x27;credit_amount&#x27;,
                                                                                                &#x27;installment_commitment&#x27;,
                                                                                                &#x27;residence_since&#x27;,
                                                                                                &#x27;existing_credits&#x27;,
                                                                                                &#x27;num_dependents&#x27;]),
                                                                                              (&#x27;cat&#x27;,
                                                                                               Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                                                Imputer(method=&#x27;simple_most_...
                                           prot_attr=&#x27;age_sex&#x27;)),
                (&#x27;log_reg_reweighing&#x27;,
                 ReweighingMetaEstimator(estimator=LogisticRegressionThreshold(C=1.0,
                                                                               class_weight=None,
                                                                               dual=False,
                                                                               fit_intercept=True,
                                                                               intercept_scaling=1,
                                                                               l1_ratio=None,
                                                                               max_iter=100,
                                                                               multi_class=&#x27;deprecated&#x27;,
                                                                               n_jobs=None,
                                                                               penalty=&#x27;l2&#x27;,
                                                                               random_state=123,
                                                                               solver=&#x27;liblinear&#x27;,
                                                                               tol=0.0001,
                                                                               verbose=0,
                                                                               warm_start=False),
                                         prot_attr=&#x27;age_sex&#x27;))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link ">i<span>Not fitted</span></span></label><div class="sk-toggleable__content "><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformerToPandas(column_transformer=ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                                                               Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                                                Imputer()),
                                                                                                               (&#x27;scaler&#x27;,
                                                                                                                Scaler())]),
                                                                                               [&#x27;duration&#x27;,
                                                                                                &#x27;credit_amount&#x27;,
                                                                                                &#x27;installment_commitment&#x27;,
                                                                                                &#x27;residence_since&#x27;,
                                                                                                &#x27;existing_credits&#x27;,
                                                                                                &#x27;num_dependents&#x27;]),
                                                                                              (&#x27;cat&#x27;,
                                                                                               Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                                                Imputer(method=&#x27;simple_most_...
                                           prot_attr=&#x27;age_sex&#x27;)),
                (&#x27;log_reg_reweighing&#x27;,
                 ReweighingMetaEstimator(estimator=LogisticRegressionThreshold(C=1.0,
                                                                               class_weight=None,
                                                                               dual=False,
                                                                               fit_intercept=True,
                                                                               intercept_scaling=1,
                                                                               l1_ratio=None,
                                                                               max_iter=100,
                                                                               multi_class=&#x27;deprecated&#x27;,
                                                                               n_jobs=None,
                                                                               penalty=&#x27;l2&#x27;,
                                                                               random_state=123,
                                                                               solver=&#x27;liblinear&#x27;,
                                                                               tol=0.0001,
                                                                               verbose=0,
                                                                               warm_start=False),
                                         prot_attr=&#x27;age_sex&#x27;))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label  sk-toggleable__label-arrow ">preprocessing: ColumnTransformerToPandas</label><div class="sk-toggleable__content "><pre>ColumnTransformerToPandas(column_transformer=ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                                              Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                               Imputer()),
                                                                                              (&#x27;scaler&#x27;,
                                                                                               Scaler())]),
                                                                              [&#x27;duration&#x27;,
                                                                               &#x27;credit_amount&#x27;,
                                                                               &#x27;installment_commitment&#x27;,
                                                                               &#x27;residence_since&#x27;,
                                                                               &#x27;existing_credits&#x27;,
                                                                               &#x27;num_dependents&#x27;]),
                                                                             (&#x27;cat&#x27;,
                                                                              Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                               Imputer(method=&#x27;simple_most_frequent&#x27;)),
                                                                                              (&#x27;encoder&#x27;,
                                                                                               Encoder(method=&#x27;one-hot&#x27;))]),
                                                                              [&#x27;checking_status&#x27;,
                                                                               &#x27;credit_history&#x27;,
                                                                               &#x27;purpose&#x27;,
                                                                               &#x27;savings_status&#x27;,
                                                                               &#x27;employment&#x27;,
                                                                               &#x27;other_parties&#x27;,
                                                                               &#x27;property_magnitude&#x27;,
                                                                               &#x27;other_payment_plans&#x27;,
                                                                               &#x27;housing&#x27;,
                                                                               &#x27;job&#x27;,
                                                                               &#x27;own_telephone&#x27;,
                                                                               &#x27;foreign_worker&#x27;,
                                                                               &#x27;marital_status&#x27;,
                                                                               &#x27;age_sex&#x27;])]),
                          prot_attr=&#x27;age_sex&#x27;)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label  sk-toggleable__label-arrow ">column_transformer: ColumnTransformer</label><div class="sk-toggleable__content "><pre>ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;, Imputer()),
                                                 (&#x27;scaler&#x27;, Scaler())]),
                                 [&#x27;duration&#x27;, &#x27;credit_amount&#x27;,
                                  &#x27;installment_commitment&#x27;, &#x27;residence_since&#x27;,
                                  &#x27;existing_credits&#x27;, &#x27;num_dependents&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  Imputer(method=&#x27;simple_most_frequent&#x27;)),
                                                 (&#x27;encoder&#x27;,
                                                  Encoder(method=&#x27;one-hot&#x27;))]),
                                 [&#x27;checking_status&#x27;, &#x27;credit_history&#x27;,
                                  &#x27;purpose&#x27;, &#x27;savings_status&#x27;, &#x27;employment&#x27;,
                                  &#x27;other_parties&#x27;, &#x27;property_magnitude&#x27;,
                                  &#x27;other_payment_plans&#x27;, &#x27;housing&#x27;, &#x27;job&#x27;,
                                  &#x27;own_telephone&#x27;, &#x27;foreign_worker&#x27;,
                                  &#x27;marital_status&#x27;, &#x27;age_sex&#x27;])])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label  sk-toggleable__label-arrow ">quant</label><div class="sk-toggleable__content "><pre>[&#x27;duration&#x27;, &#x27;credit_amount&#x27;, &#x27;installment_commitment&#x27;, &#x27;residence_since&#x27;, &#x27;existing_credits&#x27;, &#x27;num_dependents&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label  sk-toggleable__label-arrow ">Imputer</label><div class="sk-toggleable__content "><pre>Imputer()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label  sk-toggleable__label-arrow ">Scaler</label><div class="sk-toggleable__content "><pre>Scaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label  sk-toggleable__label-arrow ">cat</label><div class="sk-toggleable__content "><pre>[&#x27;checking_status&#x27;, &#x27;credit_history&#x27;, &#x27;purpose&#x27;, &#x27;savings_status&#x27;, &#x27;employment&#x27;, &#x27;other_parties&#x27;, &#x27;property_magnitude&#x27;, &#x27;other_payment_plans&#x27;, &#x27;housing&#x27;, &#x27;job&#x27;, &#x27;own_telephone&#x27;, &#x27;foreign_worker&#x27;, &#x27;marital_status&#x27;, &#x27;age_sex&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label  sk-toggleable__label-arrow ">Imputer</label><div class="sk-toggleable__content "><pre>Imputer(method=&#x27;simple_most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label  sk-toggleable__label-arrow ">Encoder</label><div class="sk-toggleable__content "><pre>Encoder(method=&#x27;one-hot&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label  sk-toggleable__label-arrow ">log_reg_reweighing: ReweighingMetaEstimator</label><div class="sk-toggleable__content "><pre>ReweighingMetaEstimator(estimator=LogisticRegressionThreshold(C=1.0,
                                                              class_weight=None,
                                                              dual=False,
                                                              fit_intercept=True,
                                                              intercept_scaling=1,
                                                              l1_ratio=None,
                                                              max_iter=100,
                                                              multi_class=&#x27;deprecated&#x27;,
                                                              n_jobs=None,
                                                              penalty=&#x27;l2&#x27;,
                                                              random_state=123,
                                                              solver=&#x27;liblinear&#x27;,
                                                              tol=0.0001,
                                                              verbose=0,
                                                              warm_start=False),
                        prot_attr=&#x27;age_sex&#x27;)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label  sk-toggleable__label-arrow ">estimator: LogisticRegressionThreshold</label><div class="sk-toggleable__content "><pre>LogisticRegressionThreshold(C=1.0, class_weight=None, dual=False,
                            fit_intercept=True, intercept_scaling=1,
                            l1_ratio=None, max_iter=100,
                            multi_class=&#x27;deprecated&#x27;, n_jobs=None, penalty=&#x27;l2&#x27;,
                            random_state=123, solver=&#x27;liblinear&#x27;, tol=0.0001,
                            verbose=0, warm_start=False)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label  sk-toggleable__label-arrow ">LogisticRegressionThreshold</label><div class="sk-toggleable__content "><pre>LogisticRegressionThreshold(C=1.0, class_weight=None, dual=False,
                            fit_intercept=True, intercept_scaling=1,
                            l1_ratio=None, max_iter=100,
                            multi_class=&#x27;deprecated&#x27;, n_jobs=None, penalty=&#x27;l2&#x27;,
                            random_state=123, solver=&#x27;liblinear&#x27;, tol=0.0001,
                            verbose=0, warm_start=False)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>The optimized parameters of the best pipeline are the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_pipeline_params</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">best_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_results</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">best_pipeline</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">best_pipeline_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__column_transformer__quant__scaler__apply&#39;: False,
 &#39;preprocessing__column_transformer__quant__scaler__method&#39;: &#39;min-max&#39;,
 &#39;preprocessing__column_transformer__cat__encoder__method&#39;: &#39;one-hot&#39;,
 &#39;preprocessing__column_transformer__cat__imputer__apply&#39;: False,
 &#39;preprocessing__column_transformer__quant__imputer__apply&#39;: False,
 &#39;log_reg_reweighing__estimator__penalty&#39;: &#39;l1&#39;,
 &#39;log_reg_reweighing__estimator__C&#39;: 50,
 &#39;log_reg_reweighing__estimator__class_weight&#39;: &#39;balanced&#39;,
 &#39;log_reg_reweighing__estimator__threshold&#39;: 0.7}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="applying-outer-evaluation">
<h2>Applying outer evaluation<a class="headerlink" href="#applying-outer-evaluation" title="Link to this heading">#</a></h2>
<section id="estimation-of-future-performance">
<h3>Estimation of future performance<a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h3>
<p>In this section we estimate the future performance of the best pipeline in terms of both predictive power (balanced accuracy) and fairness (average odds error).</p>
<p>For that purpose we use the outer evaluation method defined initially, namely, train-test split, also known as simple validation.</p>
<p>So that, we train the pipeline with the training set, and then we estimate its future performance with the testing set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_estimator</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">best_pipeline</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_pipeline_params</span><span class="p">)</span>
<span class="n">best_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">best_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The estimation of future performance if the best pipeline in terms of  predictive power (balanced accuracy) and fairness (average odds error) are the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6238095238095238
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">average_odds_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prot_attr</span><span class="o">=</span><span class="n">A_test</span><span class="p">,</span>
                   <span class="n">priv_group</span><span class="o">=</span><span class="n">sens_priv_group</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="n">response_favorable_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0933441873399384
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="demo_fairness_workflow_multisens_OR.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fairness Machine Learning Workflow</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-data">Preparing the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-evaluation-method">Outer evaluation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-evaluation-method">Inner evaluation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-pipelines">Defining pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-grids">Defining grids</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-inner-evaluation">Applying inner evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-results">Inner results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#best-pipeline-selection">Best pipeline selection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-outer-evaluation">Applying outer evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance">Estimation of future performance</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>